<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libsapling: Design flaws</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sapling_rotated.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libsapling
   &#160;<span id="projectnumber">0.6.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Design flaws </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md9"></a>
[SOLVED] Predicate and apply function overexposure</h2>
<p><code>predicate_t</code> and <code>apply_t</code> are defined as:</p>
<p><code>typedef int (*predicate_t)(const node_t *ref, const struct info_stack *info);</code></p>
<p><code>typedef void (*apply_t)(node_t *ref, const struct info_stack *info);</code></p>
<p>which exposes too much information to the user who when writing a predicate or an apply function had to call the <code>X_data</code> function to extract and then cast the data held by the node to the appropiate node type and also had to access the user info from the <code>info_stack</code> struct.</p>
<p>With the creation of typed interfaces (see <code>typed_adapters.h</code>), predicates and apply functions can be defined with direct access to the typed pointer to the data and the user information pointer.</p>
<p><code>int typed_predicate(const TYPE *data, void *info)</code></p>
<p><code>void typed_apply(TYPE *data, void *info)</code></p>
<h2><a class="anchor" id="autotoc_md10"></a>
[SOLVED] Existential NULL check</h2>
<p>In <code>graph.c</code> if you look at the <code>e_loop</code> function you will notice that unlike <code>u_loop</code>, <code>e_loop</code> doesn't NULL check whether the referred node is NULL before calling the apply function. This is correct and its purpose is to allow for insertion. It means that a new node must be appended at that reference. This however will throw a SEGV, so users always had to check for a reference that pointed to NULL when writing an apply function. This check is no longer required as it was absorbed by the typed adapters to the predicate and apply functions, so typed apply functions don't need to check for references pointing to NULL.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
[UGLY SOLUTION] Indirect access to user information</h2>
<p><code>struct info_insert</code> is used by the insert functions to specify the data to be copied to the new node's data storage and its size, and it is also used by the <code>in</code> functions of the typed interfaces to store the key object and can be used by some typed interfaces to delete or access objects with the <code>equ_preicate</code>. This means that the user information isn't passed directly but through a member pointer of <code>struct info_insert</code>, requiring one extra dereference by users. Currently, the <code>CAST_USER_INFO</code> macro in <code>typed_adapters.h</code> can be used as a short way of doing this but it is not very elegant. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
